<!DOCTYPE html>
<html>
<head>
    <title>üîê Secure JS to BAL Converter</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { 
            font-family: 'Courier New', monospace; 
            background: #0a0a0a; 
            color: #00ff00; 
            margin: 0; 
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .terminal { 
            background: #000; 
            border: 2px solid #00ff00; 
            padding: 20px; 
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .header { 
            color: #00ffff; 
            border-bottom: 1px solid #00ff00; 
            padding-bottom: 10px; 
            margin-bottom: 20px; 
        }
        textarea { 
            width: 100%; 
            height: 300px; 
            background: #111; 
            color: #00ff00; 
            border: 1px solid #008800; 
            padding: 10px; 
            font-family: monospace; 
            font-size: 14px;
            resize: vertical;
            margin-bottom: 10px;
        }
        .btn { 
            background: #008800; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            margin: 5px; 
            cursor: pointer; 
            font-weight: bold;
            border-radius: 3px;
            transition: background 0.3s;
        }
        .btn:hover { 
            background: #00aa00; 
        }
        .btn-decrypt {
            background: #0088cc;
        }
        .btn-decrypt:hover {
            background: #00aaff;
        }
        .output { 
            background: #111; 
            padding: 15px; 
            margin-top: 20px; 
            border: 1px dashed #008800; 
            font-family: monospace; 
            font-size: 14px;
        }
        .tab-container {
            display: flex;
            border-bottom: 1px solid #008800;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: 1px solid transparent;
            border-bottom: none;
            margin-right: 5px;
        }
        .tab.active {
            background: #111;
            border-color: #008800;
            border-bottom-color: #111;
            color: #00ffff;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .input-group { 
            margin: 10px 0; 
        }
        .input-group label { 
            display: block; 
            color: #00ffff; 
            margin-bottom: 5px;
        }
        .input-group input, 
        .input-group select { 
            background: #111; 
            color: #00ff00; 
            border: 1px solid #008800; 
            padding: 8px; 
            width: calc(100% - 20px);
            margin-bottom: 10px;
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #008800;
            color: white;
            padding: 15px;
            border-radius: 5px;
            display: none;
            z-index: 1000;
            max-width: 300px;
        }
        .key-display {
            background: #000;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid #ff9900;
            word-break: break-all;
            font-family: monospace;
        }
        .security-options {
            background: #111;
            padding: 15px;
            border: 1px solid #444;
            margin: 15px 0;
        }
        .hex-view {
            background: #000;
            padding: 10px;
            overflow-x: auto;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <div class="container">
        <div class="terminal">
            <div class="header">
                <h2>üîê SECURE JS to BAL CONVERTER</h2>
                <p>Protect against APK Editor with encryption key</p>
            </div>
            
            <!-- Tabs -->
            <div class="tab-container">
                <div class="tab active" onclick="switchTab('convert')">üîê Encrypt JS to BAL</div>
                <div class="tab" onclick="switchTab('decrypt')">üîì Decrypt BAL to JS</div>
            </div>
            
            <!-- Convert Tab -->
            <div id="convert-tab" class="tab-content active">
                <div>
                    <h3>üìù JavaScript Code Input</h3>
                    <textarea id="jsCode" placeholder="Paste your JavaScript code here..."></textarea>
                </div>
                
                <div class="security-options">
                    <h3>üîí Security Settings</h3>
                    
                    <div class="input-group">
                        <label for="encryptionKey">Encryption Key:</label>
                        <input type="text" id="encryptionKey" placeholder="Enter custom key or leave empty for auto-generate">
                        <small style="color:#888;">Leave empty for random key generation</small>
                    </div>
                    
                    <div class="input-group">
                        <label for="outputFileName">BAL Filename:</label>
                        <input type="text" id="outputFileName" value="ledger.bal">
                    </div>
                    
                    <div style="margin: 10px 0;">
                        <label>
                            <input type="checkbox" id="enableObfuscation" checked>
                            Enable Code Obfuscation
                        </label>
                    </div>
                </div>
                
                <div>
                    <h3>‚ö° Convert</h3>
                    <button class="btn" onclick="encryptJsToBal()">üîê ENCRYPT TO BAL</button>
                    <button class="btn" onclick="downloadBalFile()" id="downloadBtn" style="display:none;">üíæ DOWNLOAD BAL FILE</button>
                    <button class="btn" onclick="showGeneratedKey()" id="showKeyBtn" style="display:none;">üîë SHOW ENCRYPTION KEY</button>
                </div>
                
                <div class="output" id="convertResult" style="display:none;">
                    <h3>üîê Encryption Results:</h3>
                    <div id="resultDetails"></div>
                    <div id="keyDisplay" class="key-display" style="display:none;"></div>
                    <div id="hexPreview" style="margin-top: 10px;">
                        <h4>Hex Preview (first 100 bytes):</h4>
                        <div class="hex-view" id="hexDump"></div>
                    </div>
                </div>
            </div>
            
            <!-- Decrypt Tab -->
            <div id="decrypt-tab" class="tab-content">
                <div>
                    <h3>üîì BAL File Decryption</h3>
                    
                    <div class="input-group">
                        <label for="balFile">Select BAL File:</label>
                        <input type="file" id="balFile" accept=".bal">
                    </div>
                    
                    <div class="input-group">
                        <label for="decryptKey">Decryption Key:</label>
                        <input type="text" id="decryptKey" placeholder="Enter the encryption key">
                    </div>
                    
                    <button class="btn btn-decrypt" onclick="decryptBalToJs()">üîì DECRYPT BAL TO JS</button>
                    
                    <div class="output" id="decryptResult" style="display:none; margin-top: 20px;">
                        <h4>‚úÖ Decrypted JavaScript:</h4>
                        <textarea id="decryptedJs" style="height: 250px;" readonly></textarea>
                        <button class="btn" onclick="copyDecryptedJs()">üìã Copy JavaScript</button>
                        <button class="btn" onclick="saveDecryptedJs()">üíæ Save as JS File</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentBalData = null;
        let currentJsCode = null;
        let currentEncryptionKey = null;
        
        // Switch tabs
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Activate tab button
            event.target.classList.add('active');
        }
        
        // Show notification
        function showNotification(message, type = "success") {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            
            if (type === "error") {
                notification.style.background = "#cc0000";
            } else if (type === "success") {
                notification.style.background = "#008800";
            } else if (type === "info") {
                notification.style.background = "#0088cc";
            }
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        // Generate random key
        function generateRandomKey(length = 32) {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()_+-=[]{}|;:,.<>?';
            let key = '';
            for (let i = 0; i < length; i++) {
                key += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return key;
        }
        
        // Simple XOR encryption
        function xorEncrypt(data, key) {
            const encoder = new TextEncoder();
            const dataBytes = encoder.encode(data);
            const keyBytes = encoder.encode(key);
            
            const result = new Uint8Array(dataBytes.length);
            
            for (let i = 0; i < dataBytes.length; i++) {
                result[i] = dataBytes[i] ^ keyBytes[i % keyBytes.length];
            }
            
            return result;
        }
        
        // Simple XOR decryption
        function xorDecrypt(encryptedData, key) {
            const keyBytes = new TextEncoder().encode(key);
            const result = new Uint8Array(encryptedData.length);
            
            for (let i = 0; i < encryptedData.length; i++) {
                result[i] = encryptedData[i] ^ keyBytes[i % keyBytes.length];
            }
            
            const decoder = new TextDecoder();
            return decoder.decode(result);
        }
        
        // Obfuscate code
        function obfuscateCode(jsCode) {
            let obfuscated = jsCode;
            
            // Add random suffix to function names
            const functionRegex = /function\s+(\w+)/g;
            const matches = [...jsCode.matchAll(functionRegex)];
            
            matches.forEach(match => {
                const funcName = match[1];
                if (funcName.length > 3) { // Don't obfuscate very short names
                    const randomSuffix = Math.random().toString(36).substr(2, 4);
                    obfuscated = obfuscated.replace(
                        new RegExp(`\\b${funcName}\\b`, 'g'),
                        funcName + '_' + randomSuffix
                    );
                }
            });
            
            // Add comment header
            obfuscated = "/*==================================*/\n" +
                        "// ENCRYPTED BAL FILE\n" +
                        "// DO NOT EDIT - REQUIRES DECRYPTION KEY\n" +
                        "/*==================================*/\n\n" + obfuscated;
            
            return obfuscated;
        }
        
        // Create BAL format with encryption
        function createBalFormat(encryptedData, key, filename) {
            // Header structure
            const headerSize = 16;
            const header = new Uint8Array(headerSize);
            
            // Magic bytes
            header[0] = 0x42; // 'B'
            header[1] = 0x41; // 'A'
            header[2] = 0x4C; // 'L'
            header[3] = 0x32; // '2' (version with encryption)
            
            // Flags (byte 4)
            header[4] = 0x01; // Encrypted flag
            
            // Data size
            const dataSize = encryptedData.length;
            header[8] = dataSize & 0xFF;
            header[9] = (dataSize >> 8) & 0xFF;
            header[10] = (dataSize >> 16) & 0xFF;
            header[11] = (dataSize >> 24) & 0xFF;
            
            // Filename hash (simple)
            let filenameHash = 0;
            for (let i = 0; i < Math.min(filename.length, 4); i++) {
                filenameHash ^= filename.charCodeAt(i) << (i * 8);
            }
            header[12] = filenameHash & 0xFF;
            header[13] = (filenameHash >> 8) & 0xFF;
            
            // Fill rest with random
            for (let i = 14; i < headerSize; i++) {
                header[i] = Math.floor(Math.random() * 256);
            }
            
            // Combine header + encrypted data
            const finalData = new Uint8Array(headerSize + encryptedData.length);
            finalData.set(header, 0);
            finalData.set(encryptedData, headerSize);
            
            return finalData;
        }
        
        // Parse BAL format
        function parseBalFormat(balData) {
            if (balData.length < 16) {
                return { valid: false, error: "File too small" };
            }
            
            // Check magic bytes
            if (balData[0] !== 0x42 || balData[1] !== 0x41 || balData[2] !== 0x4C) {
                return { valid: false, error: "Not a BAL file" };
            }
            
            const version = balData[3];
            const isEncrypted = (balData[4] & 0x01) !== 0;
            
            // Get data size
            const dataSize = (balData[8] | (balData[9] << 8) | (balData[10] << 16) | (balData[11] << 24));
            
            // Extract encrypted data
            const headerSize = 16;
            if (balData.length < headerSize + dataSize) {
                return { valid: false, error: "File corrupted" };
            }
            
            const encryptedData = balData.slice(headerSize, headerSize + dataSize);
            
            return {
                valid: true,
                version: version,
                isEncrypted: isEncrypted,
                dataSize: dataSize,
                encryptedData: encryptedData
            };
        }
        
        // Encrypt JS to BAL
        function encryptJsToBal() {
            const jsCode = document.getElementById('jsCode').value;
            const outputFileName = document.getElementById('outputFileName').value || 'ledger.bal';
            const customKey = document.getElementById('encryptionKey').value;
            const enableObfuscation = document.getElementById('enableObfuscation').checked;
            
            if (!jsCode.trim()) {
                showNotification("‚ùå Please paste JavaScript code first!", "error");
                return;
            }
            
            try {
                // Generate or use key
                let key;
                if (customKey.trim()) {
                    key = customKey;
                    showNotification("üîë Using custom encryption key", "info");
                } else {
                    key = generateRandomKey();
                    showNotification("üîë Random encryption key generated", "info");
                }
                
                currentEncryptionKey = key;
                
                // Process JS code
                let processedCode = jsCode;
                if (enableObfuscation) {
                    processedCode = obfuscateCode(jsCode);
                }
                
                // Encrypt
                const encryptedBytes = xorEncrypt(processedCode, key);
                
                // Create BAL format
                const balData = createBalFormat(encryptedBytes, key, outputFileName);
                currentBalData = balData;
                
                // Show results
                const hexDump = getHexDump(balData.slice(0, 100));
                
                document.getElementById('resultDetails').innerHTML = `
                    <div style="color:#00ff00;">
                        <p>‚úÖ Encryption successful!</p>
                        <p>üìÅ Output file: ${outputFileName}</p>
                        <p>üìä Original size: ${jsCode.length} bytes</p>
                        <p>üîí Encrypted size: ${balData.length} bytes</p>
                        <p>üîê Encryption: XOR with key</p>
                        <p>üé≠ Obfuscation: ${enableObfuscation ? 'Enabled' : 'Disabled'}</p>
                        <p>‚ö†Ô∏è APK Editor protection: STRONG (requires key)</p>
                        <p>‚è±Ô∏è Timestamp: ${new Date().toLocaleString()}</p>
                    </div>
                `;
                
                document.getElementById('hexDump').textContent = hexDump;
                document.getElementById('convertResult').style.display = 'block';
                document.getElementById('downloadBtn').style.display = 'block';
                document.getElementById('showKeyBtn').style.display = 'block';
                
                showNotification("‚úÖ JS encrypted to BAL successfully!", "success");
                
            } catch (error) {
                showNotification("‚ùå Encryption error: " + error.message, "error");
            }
        }
        
        // Show generated key
        function showGeneratedKey() {
            if (!currentEncryptionKey) {
                showNotification("‚ùå No key generated yet", "error");
                return;
            }
            
            document.getElementById('keyDisplay').innerHTML = `
                <strong>üîë ENCRYPTION KEY:</strong><br>
                <div style="color:#ff9900; font-size: 16px; margin: 10px 0;">${currentEncryptionKey}</div>
                <strong>‚ö†Ô∏è IMPORTANT:</strong> Save this key! You need it to decrypt the BAL file.<br>
                <strong>üìù Copy and store securely.</strong>
            `;
            document.getElementById('keyDisplay').style.display = 'block';
            
            showNotification("üîë Encryption key displayed", "info");
        }
        
        // Get hex dump
        function getHexDump(data, bytesPerLine = 16) {
            let hex = "";
            for (let i = 0; i < Math.min(data.length, 100); i++) {
                if (i % bytesPerLine === 0) {
                    hex += i.toString(16).padStart(4, '0') + ': ';
                }
                hex += data[i].toString(16).padStart(2, '0') + ' ';
                if ((i + 1) % bytesPerLine === 0) {
                    hex += '\n';
                }
            }
            return hex;
        }
        
        // Download BAL file
        function downloadBalFile() {
            if (!currentBalData) {
                showNotification("‚ùå No BAL data to download!", "error");
                return;
            }
            
            const outputFileName = document.getElementById('outputFileName').value || 'ledger.bal';
            
            try {
                const blob = new Blob([currentBalData], { type: 'application/octet-stream' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = outputFileName;
                a.style.display = 'none';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                URL.revokeObjectURL(url);
                
                showNotification(`‚úÖ ${outputFileName} downloaded successfully!`, "success");
                
            } catch (error) {
                showNotification("‚ùå Download error: " + error, "error");
            }
        }
        
        // Decrypt BAL to JS
        function decryptBalToJs() {
            const fileInput = document.getElementById('balFile');
            const key = document.getElementById('decryptKey').value;
            
            if (!fileInput.files.length) {
                showNotification("‚ùå Please select a BAL file first", "error");
                return;
            }
            
            if (!key) {
                showNotification("‚ùå Please enter decryption key", "error");
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const arrayBuffer = e.target.result;
                    const balData = new Uint8Array(arrayBuffer);
                    
                    // Parse BAL format
                    const parsed = parseBalFormat(balData);
                    if (!parsed.valid) {
                        showNotification("‚ùå " + parsed.error, "error");
                        return;
                    }
                    
                    if (!parsed.isEncrypted) {
                        showNotification("‚ÑπÔ∏è This BAL file is not encrypted", "info");
                        return;
                    }
                    
                    // Decrypt with key
                    const decryptedText = xorDecrypt(parsed.encryptedData, key);
                    
                    // Save and display
                    currentJsCode = decryptedText;
                    document.getElementById('decryptedJs').value = decryptedText;
                    document.getElementById('decryptResult').style.display = 'block';
                    
                    showNotification("‚úÖ BAL file decrypted successfully!", "success");
                    
                } catch (error) {
                    showNotification("‚ùå Decryption failed! Wrong key or corrupted file", "error");
                }
            };
            
            reader.onerror = function() {
                showNotification("‚ùå Error reading file", "error");
            };
            
            reader.readAsArrayBuffer(file);
        }
        
        // Copy decrypted JS to clipboard
        function copyDecryptedJs() {
            const decryptedJs = document.getElementById('decryptedJs');
            
            if (!decryptedJs.value.trim()) {
                showNotification("‚ùå No JavaScript to copy", "error");
                return;
            }
            
            decryptedJs.select();
            decryptedJs.setSelectionRange(0, 99999);
            
            try {
                navigator.clipboard.writeText(decryptedJs.value).then(() => {
                    showNotification("‚úÖ JavaScript copied to clipboard!", "success");
                }).catch(err => {
                    // Fallback
                    document.execCommand('copy');
                    showNotification("‚úÖ JavaScript copied to clipboard!", "success");
                });
            } catch (err) {
                showNotification("‚ùå Failed to copy", "error");
            }
        }
        
        // Save decrypted JS as file
        function saveDecryptedJs() {
            if (!currentJsCode) {
                showNotification("‚ùå No JavaScript to save", "error");
                return;
            }
            
            try {
                const blob = new Blob([currentJsCode], { type: 'text/javascript' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = 'decrypted_ledger.js';
                a.style.display = 'none';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                URL.revokeObjectURL(url);
                
                showNotification("‚úÖ JavaScript saved as decrypted_ledger.js", "success");
                
            } catch (error) {
                showNotification("‚ùå Save error: " + error, "error");
            }
        }
        
        // Drag and drop for JS code
        document.getElementById('jsCode').addEventListener('dragover', (e) => {
            e.preventDefault();
        });
        
        document.getElementById('jsCode').addEventListener('drop', (e) => {
            e.preventDefault();
            const file = e.dataTransfer.files[0];
            if (file && (file.name.endsWith('.js') || file.name.endsWith('.txt'))) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById('jsCode').value = e.target.result;
                    const fileName = file.name.replace('.js', '').replace('.txt', '');
                    document.getElementById('outputFileName').value = fileName + '.bal';
                    showNotification(`‚úÖ Loaded file: ${file.name}`, "success");
                };
                reader.readAsText(file);
            }
        });
        
        // Auto-generate key on focus
        document.getElementById('encryptionKey').addEventListener('focus', function() {
            if (!this.value.trim()) {
                this.value = generateRandomKey(24);
                showNotification("üîë Random key auto-generated", "info");
            }
        });
    </script>
</body>
</html>
